<template>
  <div id="app">
    <v-app :style="`color: ${text_color};`">
      <sidebar-navigation></sidebar-navigation>

      <app-toolbar></app-toolbar>

      <v-content :style="`padding-bottom: ${footer_visible ? 44 : 20}px;`">
        <v-container class="no-padding" fluid fill-height align>
          <v-layout row align-space-between all fill-height>
            <sidebar-main fill-height></sidebar-main>
            <v-flex :xs10="is_sidebar_open" :xs12="!is_sidebar_open" :style="`padding-left: 0.5em; background: ${primary_color};`">
              <editor-shell-tab-system></editor-shell-tab-system>
              <editor-shell-content-manager></editor-shell-content-manager>

              <plugin-install-main v-if="render_plugin_window"></plugin-install-main>
              <window-factory-main></window-factory-main>
              <documentation-main/>
              <context-menu-main/>
              <json-editor-hover-card/>
            </v-flex>
          </v-layout>
        </v-container>
      </v-content>

      <v-footer :class="footer_visible ? 'big' : ''" fixed app :style="`background-color: ${secondary_color}; color: unset;`">
        <footer-main></footer-main>
        <v-spacer></v-spacer>
        <v-divider v-if="footer_visible" vertical></v-divider>
        <span style="padding: 0 1em; white-space: nowrap;">created by solvedDev</span>
      </v-footer>
    </v-app>
  </div>
</template>

<script>
  import AppToolbar from "@/components/AppToolbar";
  import SidebarNavigation from "@/components/sidebar/Navigation";
  import SidebarMain from "@/components/sidebar/Main";
  import EditorShellTabSystem from "@/components/editor_shell/TabSystem";
  import JsonEditorHoverCard from "@/components/editor_shell/JsonEditor/HoverCard";
  import EditorShellContentManager from "@/components/editor_shell/ContentManager";
  import PluginInstallMain from "@/components/plugin_install/Main";
  import WindowFactoryMain from "@/components/windowFactory/Main";
  import FooterMain from "@/components/footer/Main";
  import ContextMenuMain from "@/components/context_menu/Main";
  import DocumentationMain from "@/components/documentation/Main";

  import UpdateWindow from "./windows/UpdateApp";
  import SETTINGS from "./store/Settings";
  import { mapGetters } from 'vuex';
  
  export default {
    name: 'bridge',
    components: {
      AppToolbar,
      SidebarNavigation,
      SidebarMain,
      EditorShellTabSystem,
      EditorShellContentManager,
      PluginInstallMain,
      WindowFactoryMain,
      FooterMain,
      ContextMenuMain,
      JsonEditorHoverCard,
      DocumentationMain
    },
    created() {
      SETTINGS.setup();
    },
    mounted() {
      if(process.env.NODE_ENV !== "development") setTimeout(() => new UpdateWindow(), 1000);
    },
    computed: {
      is_sidebar_open() {
        return this.$store.state.SidebarMenu.menu_state > 0;
      },
      footer_visible() {
        return this.$store.state.Footer.elements.length > 0;
      },
      is_plugin_window_open() {
        return this.$store.state.Plugins.is_menu_open;
      },
      ...mapGetters([
        "text_color",
        "primary_color",
        "secondary_color"
      ])
    },
    watch: {
      is_plugin_window_open(to) {
        if(to) this.render_plugin_window = true
        else window.setTimeout(() => this.render_plugin_window = false, 100)
      }
    },
    data() {
      return {
        content: "",
        file: "",
        path: "",
        render_plugin_window: false
      };
    }
  }
</script>

<style>
  @import url('https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Material+Icons');
  @import url('https://cdn.materialdesignicons.com/2.5.94/css/materialdesignicons.min.css');

  /* Global CSS */
  html {
    overflow: hidden;
  }
  body {
    overflow: unset;
  }
  textarea {
    outline: none;
  }

  /* SCROLLBAR */
  *::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }
  *::-webkit-scrollbar-track {
    box-shadow: inset 0 0 3px rgba(0, 0, 0, 0.5);
  }
  *::-webkit-scrollbar-thumb {
    background-color: rgba(0, 0, 0, 0.35);
    box-shadow: inset 0 0 1px rgba(0, 0, 0, 0.4);
  }

  /* NO TEXT SELECTION */
  :root {
    -moz-user-select: none;
    -khtml-user-select: none;
    -webkit-user-select: none;
    -ms-user-select: none;
    user-select: none;
  }

  /* PADDING FIXES */
  aside {
    padding-top: 24px;
  }
  aside nav div.v-toolbar__content {
    padding: 0;
    padding-left: 0.5em;
  }
  .v-content .v-content__wrap > .container {
    padding-left: 0;
    padding-top: 0;
  }

  a {
    color: unset !important;
  }
  table {
    border-color: unset;
  }

  .theme--light.v-btn,
  .theme--light.v-icon,
  .theme--light.v-label,
  .theme--light.v-select .v-select__selections,
  .theme--light.v-list .v-list__tile__sub-title {
    color: unset;
    background: unset;
  }

  .theme--light.v-list,
  .theme--light.v-card,
  .theme--light.application  {
    color: unset;
    background: var(--tertiary-color);
  }

  .text--primary {
    color: var(--text-color) !important;
  }

  .text--secondary {
    color: var(--text-color) !important;
    opacity: 0.9;
  }
</style>

<style scoped>
  .no-padding {
    padding: 0;
  }
  .v-footer {
    transition: all ease-in-out 200ms;
    height: 20px !important;
    min-height: 12px;
  }
  .v-footer.big {
    height: 44px !important;
  }
</style>
